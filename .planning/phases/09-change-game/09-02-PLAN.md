---
phase: 09-change-game
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - js/game/world.js
autonomous: true

must_haves:
  truths:
    - "Map displays Pallet Town layout with grass, paths, trees"
    - "3 buildings visible: Player House, Rival House, Oak's Lab"
    - "Player can walk around the outdoor map"
    - "Tile types match sprite coordinate names from sprites.js"
  artifacts:
    - path: "js/game/world.js"
      provides: "Pallet Town map generation and tile definitions"
      contains: "generateCampusMap"
  key_links:
    - from: "js/game/world.js"
      to: "js/game/sprites.js"
      via: "getTileSprite returning sprite names"
      pattern: "getTileSprite.*return.*grass|path|tree"
---

<objective>
Redefine tile types and generate Pallet Town outdoor map.

Purpose: The current world.js has 70+ tile types for LPC Cambridge campus. Pallet Town uses different tiles entirely. This plan replaces the TILES enum, buildings definitions, and generateCampusMap() with Pallet Town equivalents.

Output: A world.js that:
1. Has TILES enum matching sprites.js coordinate names
2. Has 3 buildings: playerHouse, rivalHouse, oakLab
3. Generates a ~20x20 Pallet Town outdoor map
4. getTileSprite() returns valid sprite names
</objective>

<execution_context>
@/home/sam/.claude/get-shit-done/workflows/execute-plan.md
@/home/sam/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-change-game/09-RESEARCH.md
@.planning/phases/09-change-game/09-01-SUMMARY.md

Key source files:
@js/game/world.js
@js/game/sprites.js (check TILE_COORDS names)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace TILES enum with Pokemon tile types</name>
  <files>js/game/world.js</files>
  <action>
Remove ALL existing TILES entries and replace with Pokemon-specific tiles.

Reference the TILE_COORDS names from sprites.js (created in Plan 01) to ensure consistency.

New TILES enum structure (exact names must match sprites.js):

```javascript
TILES: {
    // Outdoor terrain
    GRASS: 0,
    PATH: 1,
    FLOWER: 2,
    WATER: 3,
    TREE_TRUNK: 4,
    TREE_TOP: 5,
    FENCE: 6,

    // Building exteriors
    HOUSE_WALL: 10,
    HOUSE_ROOF_LEFT: 11,
    HOUSE_ROOF_MID: 12,
    HOUSE_ROOF_RIGHT: 13,
    HOUSE_DOOR: 14,
    HOUSE_WINDOW: 15,
    LAB_WALL: 16,
    LAB_ROOF: 17,
    LAB_DOOR: 18,
    LAB_WINDOW: 19,

    // Interior - floor/walls
    FLOOR_WOOD: 20,
    FLOOR_TILE: 21,
    INT_WALL: 22,
    INT_DOOR: 23,
    STAIRS_UP: 24,
    STAIRS_DOWN: 25,

    // Interior - furniture
    TABLE: 30,
    CHAIR: 31,
    BOOKSHELF: 32,
    COMPUTER: 33,
    TV: 34,
    SOFA: 35,
    PLANT: 36,
    RUG: 37,
    BED: 38,
    DESK: 39,

    // Lab specific
    LAB_TABLE: 40,
    LAB_MACHINE: 41,
    POKEBALL_MACHINE: 42
}
```

Adjust based on what tiles are actually available in the Pallet Town sprite sheet. The exact numbers don't matter, but names must be consistent with sprites.js TILE_COORDS.
  </action>
  <verify>
Read world.js TILES enum and sprites.js TILE_COORDS - verify every TILES entry has a matching coordinate in sprites.js
  </verify>
  <done>TILES enum replaced with Pokemon tile types matching sprites.js</done>
</task>

<task type="auto">
  <name>Task 2: Replace buildings definitions</name>
  <files>js/game/world.js</files>
  <action>
Replace the buildings object from 5 Cambridge buildings to 3 Pallet Town buildings:

```javascript
buildings: {
    playerHouse: {
        name: "Player's House",
        contentKey: 'about',  // About Me content
        entrance: { x: 6, y: 10 },  // Adjust based on map
        tiles: { x: 4, y: 7, w: 5, h: 4 },
        style: 'house',
        floors: 2  // Has 1F and 2F
    },
    rivalHouse: {
        name: "Rival's House",
        contentKey: 'talks_media',  // Talks + Media content
        entrance: { x: 14, y: 10 },
        tiles: { x: 12, y: 7, w: 5, h: 4 },
        style: 'house'
    },
    oakLab: {
        name: "Professor Oak's Lab",
        contentKey: 'research_publications',  // Research + Publications
        entrance: { x: 10, y: 16 },
        tiles: { x: 7, y: 13, w: 7, h: 4 },
        style: 'lab'
    }
}
```

Content mapping rationale:
- Player House: About (personal space = personal info)
- Rival House: Talks + Media (social space = public appearances)
- Oak's Lab: Research + Publications (academic space = academic work)

Adjust entrance coordinates after Task 3 generates the map.
  </action>
  <verify>
Read world.js buildings object - should have exactly 3 buildings: playerHouse, rivalHouse, oakLab
  </verify>
  <done>Buildings reduced to 3 Pallet Town buildings with content mappings</done>
</task>

<task type="auto">
  <name>Task 3: Generate Pallet Town outdoor map</name>
  <files>js/game/world.js</files>
  <action>
Replace generateCampusMap() with a Pallet Town layout.

Reference the Pallet Town sprite sheet (left section) for the layout:
- ~20x18 tiles (smaller than current 40x30)
- Dense tree border around edges
- Central path from bottom to middle
- Player House (left, red roof)
- Rival House (right, red roof)
- Oak's Lab (bottom center, larger, gray roof)
- Small pond (bottom left)
- Flowers scattered
- Mailboxes near houses

```javascript
generateCampusMap() {
    const T = this.TILES;
    const w = 20;   // Pallet Town width
    const h = 18;   // Pallet Town height
    this.width = w;
    this.height = h;

    const ground = new Array(w * h).fill(T.GRASS);
    const objects = new Array(w * h).fill(-1);
    const collision = new Array(w * h).fill(0);
    const interact = new Array(w * h).fill(null);

    const setTile = (x, y, groundTile, objectTile = -1, blocked = false, interactData = null) => {
        if (x < 0 || x >= w || y < 0 || y >= h) return;
        const idx = y * w + x;
        if (groundTile !== null) ground[idx] = groundTile;
        if (objectTile !== -1) objects[idx] = objectTile;
        if (blocked) collision[idx] = 1;
        if (interactData) interact[idx] = interactData;
    };

    const placeTree = (x, y) => {
        setTile(x, y, T.GRASS, T.TREE_TRUNK, true);
        if (y > 0) setTile(x, y - 1, null, T.TREE_TOP, true);
    };

    // 1. TREE BORDER (dense forest edge)
    for (let x = 0; x < w; x++) {
        placeTree(x, 1);
        if (x < 8 || x > 12) placeTree(x, 2);
    }
    for (let y = 2; y < h - 1; y++) {
        placeTree(0, y);
        placeTree(1, y);
        placeTree(w - 1, y);
        placeTree(w - 2, y);
    }

    // 2. MAIN PATH (vertical from bottom)
    for (let y = 3; y < h; y++) {
        setTile(9, y, T.PATH);
        setTile(10, y, T.PATH);
    }

    // 3. HORIZONTAL PATHS to houses
    for (let x = 4; x < 9; x++) setTile(x, 8, T.PATH);
    for (let x = 11; x < 16; x++) setTile(x, 8, T.PATH);

    // 4. PLAYER'S HOUSE (left side, ~x:4-8, y:5-8)
    this.buildHouse(ground, objects, collision, interact, 'playerHouse', 4, 5, 5, 4);

    // 5. RIVAL'S HOUSE (right side, ~x:12-16, y:5-8)
    this.buildHouse(ground, objects, collision, interact, 'rivalHouse', 12, 5, 5, 4);

    // 6. OAK'S LAB (bottom center, ~x:7-13, y:12-16)
    this.buildLab(ground, objects, collision, interact, 'oakLab', 7, 12, 7, 5);

    // 7. FLOWERS (decorative)
    const flowerSpots = [[5, 9], [6, 9], [14, 9], [15, 9], [8, 11], [12, 11]];
    flowerSpots.forEach(([x, y]) => setTile(x, y, T.FLOWER));

    // 8. POND (bottom left area)
    for (let x = 3; x <= 5; x++) {
        for (let y = 14; y <= 16; y++) {
            setTile(x, y, T.WATER, -1, true);
        }
    }

    // 9. FENCE along path bottom
    setTile(8, h - 1, T.GRASS, T.FENCE, true);
    setTile(11, h - 1, T.GRASS, T.FENCE, true);

    this.campusMap = {
        width: w,
        height: h,
        layers: { ground, objects, collision, interact }
    };
}
```

Also add helper methods buildHouse() and buildLab() similar to current buildTraditionalBuilding() and buildModernBuilding(), but using Pokemon tile types.

Update buildings object entrance coordinates to match the actual placement.
  </action>
  <verify>
Run `npm run dev`:
1. Game loads without errors
2. Map is approximately 20x18 (check World.width, World.height in console)
3. Visible Pallet Town layout (grass, trees, paths, 3 buildings)
4. Player can walk around (collision works)
  </verify>
  <done>Pallet Town outdoor map generated with 3 buildings and proper collision</done>
</task>

</tasks>

<verification>
After all tasks:
1. World.TILES has Pokemon-specific tile types
2. World.buildings has 3 entries: playerHouse, rivalHouse, oakLab
3. Map dimensions ~20x18 (not 40x30)
4. getTileSprite() returns valid sprite names
5. Player can walk around the outdoor map
</verification>

<success_criteria>
- TILES enum completely replaced with Pokemon tile types
- 3 buildings defined with correct content mappings
- Pallet Town map generates with proper layout
- Trees form border, paths connect buildings
- Collision prevents walking through buildings/trees/water
- Player spawns in walkable area
</success_criteria>

<output>
After completion, create `.planning/phases/09-change-game/09-02-SUMMARY.md`
</output>
