---
phase: 09-change-game
plan: 05
type: execute
wave: 3
depends_on: ["09-04"]
files_modified:
  - js/game/buildings.js
autonomous: true

must_haves:
  truths:
    - "Entering Player House shows About-related welcome message"
    - "Entering Rival House shows Talks/Media welcome message"
    - "Entering Oak's Lab shows Research/Publications welcome message"
    - "Interacting with bookshelves shows publications panel"
    - "Interacting with TV/media equipment shows media panel"
    - "Stairs interaction moves between floors"
  artifacts:
    - path: "js/game/buildings.js"
      provides: "Content handlers and welcome messages for 3 buildings"
      contains: "playerHouse|rivalHouse|oakLab"
  key_links:
    - from: "js/game/buildings.js"
      to: "SITE_CONTENT"
      via: "showPublicationsPanel, showTalksPanel, showMediaPanel"
      pattern: "SITE_CONTENT\\.(publications|talks|media|research)"
---

<objective>
Update buildings.js for 3 Pallet Town buildings with correct content handling.

Purpose: buildings.js handles welcome messages, interaction processing, and content display. It needs to be updated for the new 3-building structure and consolidated content mapping.

Output:
1. Updated welcome messages for playerHouse, rivalHouse, oakLab
2. Interaction handlers for all content types
3. Stairs handling for Player House floors
4. Remove old 5-building references
</objective>

<execution_context>
@/home/sam/.claude/get-shit-done/workflows/execute-plan.md
@/home/sam/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-change-game/09-RESEARCH.md
@.planning/phases/09-change-game/09-04-SUMMARY.md

Key source files:
@js/game/buildings.js
@js/game/world.js (building definitions, interaction types)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update welcome messages and building info</name>
  <files>js/game/buildings.js</files>
  <action>
Update getWelcomeMessage() and related functions for the 3 new buildings:

```javascript
// Get welcome message for a building (context-aware)
getWelcomeMessage(buildingId, isFirstVisit = true) {
    const building = World.buildings[buildingId];
    const name = building?.name || 'this building';

    const firstVisitMessages = {
        playerHouse: "Welcome home! This is your house. Look around to learn about Sam's background, education, and interests.",
        playerHouse2F: "Your bedroom and study area. Check the desk and bookshelves for more about Sam's academic journey.",
        rivalHouse: "Welcome to your rival's house! They've got quite the media setup. Browse around to find talks and media appearances.",
        oakLab: "Welcome to Professor Oak's Laboratory! This is where the research happens. Explore to discover publications and ongoing projects."
    };

    const returnVisitMessages = {
        playerHouse: "Welcome back home! Feel free to look around.",
        playerHouse2F: "Back in your room. Your research notes are on the desk.",
        rivalHouse: "Back at your rival's place. Any new episodes on TV?",
        oakLab: "Welcome back to the lab! The research never stops."
    };

    if (isFirstVisit) {
        return firstVisitMessages[buildingId] || `Welcome to ${name}!`;
    } else {
        return returnVisitMessages[buildingId] || `Welcome back to ${name}!`;
    }
}
```

Also update getBuildingInfo() to work with new building IDs.

Remove references to old buildings: pembroke, library, lab, station, theatre.
  </action>
  <verify>
Read buildings.js getWelcomeMessage():
- Has entries for playerHouse, playerHouse2F, rivalHouse, oakLab
- No references to pembroke, library, station, theatre
  </verify>
  <done>Welcome messages updated for 3 Pallet Town buildings</done>
</task>

<task type="auto">
  <name>Task 2: Update handleInteraction for new content types</name>
  <files>js/game/buildings.js</files>
  <action>
Update handleInteraction() to process the interaction types from the new interiors:

```javascript
handleInteraction(interaction) {
    if (this.actionCooldown) return null;

    this.actionCooldown = true;
    setTimeout(() => { this.actionCooldown = false; }, 200);

    if (!interaction) return null;

    switch (interaction.type) {
        case 'entrance':
        case 'door':
            return { action: 'enter', building: interaction.building };

        case 'exit':
            return { action: 'exit' };

        case 'stairs':
            return { action: 'stairs', floor: interaction.floor };

        case 'sign':
            this.showDialog('Sign', interaction.text);
            return { action: 'dialog' };

        // About content (Player House)
        case 'about':
            this.showAboutContent(interaction.subtype);
            return { action: 'dialog' };

        // Publications (Oak's Lab bookshelves)
        case 'publication':
            if (interaction.showPanel) {
                this.showPublicationsPanel();
            } else {
                this.showPublicationContent(interaction.index);
            }
            return { action: 'dialog' };

        // Research (Oak's Lab tables/computers)
        case 'research':
            if (interaction.showPanel) {
                this.showResearchPanel();
            } else {
                this.showResearchContent(interaction.index);
            }
            return { action: 'dialog' };

        // Talks (Rival House bookshelves)
        case 'talks':
            if (interaction.showPanel) {
                this.showTalksPanel();
            } else {
                this.showTalksContent(interaction.index);
            }
            return { action: 'dialog' };

        // Media (Rival House TV)
        case 'media':
            if (interaction.showPanel) {
                this.showMediaPanel();
            } else {
                this.showMediaContent(interaction.index);
            }
            return { action: 'dialog' };

        case 'object':
            this.showObjectContent(interaction);
            return { action: 'dialog' };
    }

    return null;
}
```

Add new showAboutContent() method for About interactions:

```javascript
showAboutContent(subtype) {
    const about = SITE_CONTENT.about;

    switch (subtype) {
        case 'bio':
            const bioHtml = about.bio.map(p => `<p>${p}</p>`).join('');
            this.showContentPanel('About Sam', bioHtml);
            break;

        case 'education':
            const eduHtml = about.education.map(edu =>
                `<div class="panel-item">
                    <h4>${edu.degree}</h4>
                    <p>${edu.institution}, ${edu.year}</p>
                </div>`
            ).join('');
            this.showContentPanel('Education', eduHtml);
            break;

        case 'links':
            const linksHtml = (about.links || [])
                .filter(link => link.url && link.url !== '#')
                .map(link =>
                    `<a href="${link.url}" target="_blank" rel="noopener" class="panel-link">${link.label}</a>`
                ).join('');
            this.showContentPanel('Connect', linksHtml || '<p>Contact links coming soon.</p>');
            break;

        case 'research':
            // Show research interests from about data
            const researchHtml = `
                <p>${about.research || 'Conservation AI and machine learning research.'}</p>
            `;
            this.showContentPanel('Research Interests', researchHtml);
            break;

        default:
            this.showContentPanel('About', about.bio[0] || 'Learn more about Sam.');
    }
}
```
  </action>
  <verify>
Read buildings.js handleInteraction():
- Handles 'about', 'publication', 'research', 'talks', 'media', 'stairs' types
- showAboutContent() method exists
- 'stairs' returns action: 'stairs' with floor property
  </verify>
  <done>Interaction handler updated for all content types</done>
</task>

<task type="auto">
  <name>Task 3: Update interaction names and prompts</name>
  <files>js/game/buildings.js</files>
  <action>
Update getInteractionName() to provide appropriate names for Pokemon-themed objects:

```javascript
getInteractionName(interaction) {
    const nameMap = {
        // Content types
        'publication': 'Bookshelf',
        'media': 'TV',
        'research': 'Lab Equipment',
        'talks': 'Bookshelf',
        'about': 'Home Items',

        // Navigation
        'entrance': interaction.name || 'Entrance',
        'door': interaction.name || 'Door',
        'exit': 'Exit',
        'stairs': interaction.floor === '2F' ? 'Stairs (Up)' : 'Stairs (Down)',

        // Objects
        'sign': 'Sign',
        'object': interaction.id || 'Object'
    };

    return nameMap[interaction.type] || 'Interact';
}
```

Update action text in updatePrompt() to be Pokemon-appropriate:

```javascript
updatePrompt(interaction, isMobile) {
    if (interaction && !this.dialogOpen && !this.panelOpen) {
        this.currentInteraction = interaction;

        let objectName = interaction.name || this.getInteractionName(interaction);
        let actionText = isMobile ? 'Tap' : 'Press A';  // Pokemon style!

        switch (interaction.type) {
            case 'entrance':
            case 'door':
                actionText = isMobile ? 'Tap to enter' : 'Press A to enter';
                break;
            case 'stairs':
                actionText = isMobile ? 'Tap to climb' : 'Press A to climb';
                break;
            case 'exit':
                objectName = 'Door';
                actionText = isMobile ? 'Tap to exit' : 'Press A to exit';
                break;
            default:
                actionText = isMobile ? 'Tap to interact' : 'Press A to interact';
        }

        this.promptElement.innerHTML = `<span class="prompt-object">${objectName}</span><br><span class="prompt-action">${actionText}</span>`;
        this.promptElement.style.display = 'block';
        this.promptVisible = true;
    } else {
        this.hidePrompt();
    }
}
```

Note: "Press A" is the Pokemon convention, but the actual key is still ENTER. This is a cosmetic change for flavor.
  </action>
  <verify>
Read buildings.js:
- getInteractionName() handles all new interaction types
- updatePrompt() uses "Press A" language (Pokemon style)
- Stairs have appropriate "Up" or "Down" labels
  </verify>
  <done>Interaction names and prompts updated for Pokemon theme</done>
</task>

</tasks>

<verification>
After all tasks:
1. Entering playerHouse shows "Welcome home!" message
2. Entering rivalHouse shows talks/media focused message
3. Entering oakLab shows research/publications message
4. Bookshelves in Oak's Lab trigger showPublicationsPanel()
5. TV in Rival House triggers showMediaPanel()
6. Stairs interaction returns proper action type
7. No references to old 5-building system remain
</verification>

<success_criteria>
- Welcome messages themed for each Pallet Town building
- All interaction types handled: about, publication, research, talks, media, stairs
- showAboutContent() method displays about.json data
- getInteractionName() returns Pokemon-appropriate names
- Prompt text uses "Press A" for Pokemon flavor
- Old pembroke/library/station/theatre references removed
</success_criteria>

<output>
After completion, create `.planning/phases/09-change-game/09-05-SUMMARY.md`
</output>
