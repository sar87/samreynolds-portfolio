---
phase: 09-change-game
plan: 04
type: execute
wave: 3
depends_on: ["09-02"]
files_modified:
  - js/game/world.js
autonomous: true

must_haves:
  truths:
    - "Player House has 1F interior with living room furniture"
    - "Player House has 2F interior with bedroom/study"
    - "Rival House has interior with TV/media area"
    - "Oak's Lab has interior with bookshelves and lab equipment"
    - "All interiors have interactive zones for content"
    - "All interiors have exits that return to outdoor map"
  artifacts:
    - path: "js/game/world.js"
      provides: "Interior map generation for 3 buildings"
      contains: "generatePlayerHouse1F|generateOakLab"
  key_links:
    - from: "js/game/world.js interiors"
      to: "js/game/buildings.js"
      via: "interact array with content type markers"
      pattern: "type.*about|talks|research|publication"
---

<objective>
Generate interior maps for all 3 Pallet Town buildings with content interaction zones.

Purpose: Each building interior must contain interactive objects that display academic content. The interiors should match Pokemon FireRed/LeafGreen style while mapping to the site content.

Output:
1. Player House 1F - Living room with About Me content zones
2. Player House 2F - Bedroom/study with additional About content
3. Rival House - Living area with Talks + Media content zones
4. Oak's Lab - Laboratory with Research + Publications content zones
</objective>

<execution_context>
@/home/sam/.claude/get-shit-done/workflows/execute-plan.md
@/home/sam/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-change-game/09-RESEARCH.md
@.planning/phases/09-change-game/09-02-SUMMARY.md

Key source files:
@js/game/world.js (current interior generation patterns)
@js/game/buildings.js (interaction handler types)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Generate Player House interiors (1F + 2F)</name>
  <files>js/game/world.js</files>
  <action>
Reference the Player House sections in the Pallet Town sprite sheet (labeled "Player House [1F]" and "[2F]").

Create two interior generation functions:

**generatePlayerHouse1F()** (~10x8 tiles)
Based on Pokemon sprite sheet layout:
- Entry door at bottom center
- TV on left wall (with sofa facing it) - About bio interaction
- Table in center - About links interaction
- Stairs to 2F on right side
- Plant decorations

```javascript
generatePlayerHouse1F() {
    const T = this.TILES;
    const w = 10;
    const h = 8;

    const ground = new Array(w * h).fill(T.FLOOR_WOOD);
    const objects = new Array(w * h).fill(-1);
    const collision = new Array(w * h).fill(0);
    const interact = new Array(w * h).fill(null);

    // Top wall
    for (let x = 0; x < w; x++) {
        objects[x] = T.INT_WALL;
        collision[x] = 1;
    }

    // Side walls
    for (let y = 0; y < h; y++) {
        collision[y * w] = 1;
        collision[y * w + (w - 1)] = 1;
    }

    // Bottom wall (except exit)
    const exitX = Math.floor(w / 2);
    for (let x = 0; x < w; x++) {
        if (x !== exitX) collision[(h - 1) * w + x] = 1;
    }

    // TV on left wall (row 1-2)
    objects[1 * w + 1] = T.TV;
    collision[1 * w + 1] = 1;
    interact[2 * w + 1] = { type: 'about', subtype: 'bio' };

    // Sofa facing TV
    objects[3 * w + 1] = T.SOFA;
    objects[3 * w + 2] = T.SOFA;
    collision[3 * w + 1] = 1;
    collision[3 * w + 2] = 1;

    // Table in center
    objects[3 * w + 5] = T.TABLE;
    collision[3 * w + 5] = 1;
    interact[4 * w + 5] = { type: 'about', subtype: 'links' };

    // Stairs to 2F (right side)
    objects[1 * w + (w - 2)] = T.STAIRS_UP;
    collision[1 * w + (w - 2)] = 1;
    interact[1 * w + (w - 2)] = { type: 'stairs', floor: '2F' };

    // Plant decoration
    objects[5 * w + 1] = T.PLANT;

    // Exit door
    interact[(h - 1) * w + exitX] = { type: 'exit' };

    return {
        name: "Player's House - 1F",
        width: w,
        height: h,
        spawn: { x: exitX, y: h - 2 },
        layers: { ground, objects, collision, interact }
    };
}
```

**generatePlayerHouse2F()** (~10x8 tiles)
- Entry from stairs (landing area)
- Bed on one side - About education interaction
- Desk with computer - About research interaction
- Bookshelves
- Stairs down

```javascript
generatePlayerHouse2F() {
    const T = this.TILES;
    const w = 10;
    const h = 8;

    // Similar structure, different furniture arrangement
    // Bed area for education content
    // Desk area for research interests
    // Stairs down to 1F
    // ...
}
```
  </action>
  <verify>
Read world.js:
- generatePlayerHouse1F() exists and generates ~10x8 interior
- generatePlayerHouse2F() exists and generates ~10x8 interior
- Both have interact zones with type 'about' or 'stairs'
- Both have exit/stairs connections
  </verify>
  <done>Player House interiors created with About content zones</done>
</task>

<task type="auto">
  <name>Task 2: Generate Rival House interior</name>
  <files>js/game/world.js</files>
  <action>
Reference the "Rival House" section in the Pallet Town sprite sheet.

**generateRivalHouse()** (~10x8 tiles)
Content: Talks + Media (combined from old Theatre + Station)
- TV area with media content - Media appearances
- Bookshelf area - Talks list
- Table with notes - Individual talk details

```javascript
generateRivalHouse() {
    const T = this.TILES;
    const w = 10;
    const h = 8;

    const ground = new Array(w * h).fill(T.FLOOR_WOOD);
    const objects = new Array(w * h).fill(-1);
    const collision = new Array(w * h).fill(0);
    const interact = new Array(w * h).fill(null);

    // Walls
    for (let x = 0; x < w; x++) {
        objects[x] = T.INT_WALL;
        collision[x] = 1;
    }
    for (let y = 0; y < h; y++) {
        collision[y * w] = 1;
        collision[y * w + (w - 1)] = 1;
    }
    const exitX = Math.floor(w / 2);
    for (let x = 0; x < w; x++) {
        if (x !== exitX) collision[(h - 1) * w + x] = 1;
    }

    // TV setup (for media content)
    objects[1 * w + 1] = T.TV;
    collision[1 * w + 1] = 1;
    objects[1 * w + 2] = T.TV;  // Wide TV
    collision[1 * w + 2] = 1;
    interact[2 * w + 1] = { type: 'media', showPanel: true };
    interact[2 * w + 2] = { type: 'media', showPanel: true };

    // Sofa
    objects[3 * w + 1] = T.SOFA;
    objects[3 * w + 2] = T.SOFA;
    collision[3 * w + 1] = 1;
    collision[3 * w + 2] = 1;

    // Bookshelf for talks (right side)
    objects[1 * w + (w - 2)] = T.BOOKSHELF;
    collision[1 * w + (w - 2)] = 1;
    objects[2 * w + (w - 2)] = T.BOOKSHELF;
    collision[2 * w + (w - 2)] = 1;
    interact[2 * w + (w - 3)] = { type: 'talks', showPanel: true };
    interact[3 * w + (w - 2)] = { type: 'talks', showPanel: true };

    // Table with notes
    objects[4 * w + 5] = T.TABLE;
    collision[4 * w + 5] = 1;
    interact[4 * w + 6] = { type: 'talks', index: 0 };
    interact[5 * w + 5] = { type: 'talks', index: 1 };

    // Exit
    interact[(h - 1) * w + exitX] = { type: 'exit' };

    return {
        name: "Rival's House",
        width: w,
        height: h,
        spawn: { x: exitX, y: h - 2 },
        layers: { ground, objects, collision, interact }
    };
}
```
  </action>
  <verify>
Read world.js:
- generateRivalHouse() exists
- Has interact zones with type 'media' and 'talks'
- Has exit interaction
  </verify>
  <done>Rival House interior created with Talks + Media content zones</done>
</task>

<task type="auto">
  <name>Task 3: Generate Oak's Lab interior</name>
  <files>js/game/world.js</files>
  <action>
Reference "Professor Oak's Lab" section in the Pallet Town sprite sheet.

**generateOakLab()** (~12x10 tiles - larger than houses)
Content: Research + Publications (combined from old Lab + Library)
- Lab tables with equipment - Research projects
- Bookshelves along walls - Publications
- Computer workstations - Research data
- Central display area

```javascript
generateOakLab() {
    const T = this.TILES;
    const w = 12;
    const h = 10;

    const ground = new Array(w * h).fill(T.FLOOR_TILE);  // Tile floor for lab
    const objects = new Array(w * h).fill(-1);
    const collision = new Array(w * h).fill(0);
    const interact = new Array(w * h).fill(null);

    // Walls
    for (let x = 0; x < w; x++) {
        objects[x] = T.INT_WALL;
        collision[x] = 1;
    }
    for (let y = 0; y < h; y++) {
        collision[y * w] = 1;
        collision[y * w + (w - 1)] = 1;
    }
    const exitX = Math.floor(w / 2);
    for (let x = 0; x < w; x++) {
        if (x !== exitX) collision[(h - 1) * w + x] = 1;
    }

    // BOOKSHELVES along top wall (Publications)
    for (let x = 2; x < w - 2; x++) {
        objects[1 * w + x] = T.BOOKSHELF;
        collision[1 * w + x] = 1;
    }
    // Publication interaction zones (front of bookshelves)
    let pubIndex = 0;
    for (let x = 3; x < w - 2; x += 2) {
        interact[2 * w + x] = { type: 'publication', index: pubIndex++, showPanel: true };
    }

    // LAB TABLES (Research)
    // Left side
    objects[4 * w + 2] = T.LAB_TABLE;
    objects[4 * w + 3] = T.LAB_TABLE;
    collision[4 * w + 2] = 1;
    collision[4 * w + 3] = 1;
    interact[5 * w + 2] = { type: 'research', index: 0 };
    interact[5 * w + 3] = { type: 'research', index: 0 };

    // Right side
    objects[4 * w + (w - 3)] = T.LAB_TABLE;
    objects[4 * w + (w - 4)] = T.LAB_TABLE;
    collision[4 * w + (w - 3)] = 1;
    collision[4 * w + (w - 4)] = 1;
    interact[5 * w + (w - 3)] = { type: 'research', index: 1 };
    interact[5 * w + (w - 4)] = { type: 'research', index: 1 };

    // COMPUTER WORKSTATIONS
    objects[6 * w + 5] = T.COMPUTER;
    objects[6 * w + 6] = T.COMPUTER;
    collision[6 * w + 5] = 1;
    collision[6 * w + 6] = 1;
    interact[7 * w + 5] = { type: 'research', showPanel: true };
    interact[7 * w + 6] = { type: 'research', showPanel: true };

    // Pokeball machine (decorative nod to Pokemon)
    objects[3 * w + (w - 2)] = T.POKEBALL_MACHINE;
    collision[3 * w + (w - 2)] = 1;

    // Plants for decoration
    objects[7 * w + 1] = T.PLANT;
    objects[7 * w + (w - 2)] = T.PLANT;

    // Exit
    interact[(h - 1) * w + exitX] = { type: 'exit' };

    return {
        name: "Professor Oak's Lab",
        width: w,
        height: h,
        spawn: { x: exitX, y: h - 2 },
        layers: { ground, objects, collision, interact }
    };
}
```

Also update generateInteriorMaps() to call the new functions:

```javascript
generateInteriorMaps() {
    this.interiorMaps.playerHouse = this.generatePlayerHouse1F();
    this.interiorMaps.playerHouse2F = this.generatePlayerHouse2F();
    this.interiorMaps.rivalHouse = this.generateRivalHouse();
    this.interiorMaps.oakLab = this.generateOakLab();
}
```

Remove old interior generation functions (generatePembrokeInterior, generateLibraryInterior, etc.)
  </action>
  <verify>
Read world.js:
- generateOakLab() exists
- Has interact zones with type 'publication' and 'research'
- generateInteriorMaps() calls all 4 new interior functions
- Old interior functions removed
  </verify>
  <done>Oak's Lab interior created with Research + Publications content zones</done>
</task>

</tasks>

<verification>
After all tasks:
1. Player House 1F has living room with About content zones
2. Player House 2F has bedroom with more About content zones
3. Rival House has TV/bookshelf areas for Talks + Media
4. Oak's Lab has bookshelves for Publications, tables for Research
5. All interiors have valid exits
6. Interaction zones use correct types: about, talks, media, research, publication
</verification>

<success_criteria>
- 4 interior maps generated (Player House 1F, 2F, Rival House, Oak's Lab)
- Each interior matches approximate Pokemon layout from sprite sheet
- Content zones mapped correctly:
  - About -> Player House (both floors)
  - Talks + Media -> Rival House
  - Research + Publications -> Oak's Lab
- All interiors have working exits
- Old Cambridge interior functions removed
</success_criteria>

<output>
After completion, create `.planning/phases/09-change-game/09-04-SUMMARY.md`
</output>
