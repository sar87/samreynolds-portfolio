---
phase: 06-interactions-content
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - js/game/buildings.js
  - data/content.json.js
autonomous: true

must_haves:
  truths:
    - "Interacting with bookcase displays publications in panel"
    - "Interacting with lab equipment displays research interests in panel"
    - "Interacting with TV/radio displays media appearances in panel"
    - "Interacting with podium displays talks in panel"
    - "Panel shows formatted content with title, venue, dates"
  artifacts:
    - path: "js/game/buildings.js"
      provides: "Content formatting methods"
      contains: "formatPublications"
    - path: "data/content.json.js"
      provides: "SITE_CONTENT with talks array"
      contains: "talks:"
  key_links:
    - from: "js/game/buildings.js"
      to: "SITE_CONTENT"
      via: "global variable access"
      pattern: "SITE_CONTENT\\."
---

<objective>
Wire JSON content data to the content panel, creating formatted displays for publications, talks, media, and research.

Purpose: Connect the interactive objects in building interiors to actual academic content, displaying properly formatted lists in the panel overlay.

Output: Content formatting methods that transform JSON data into styled HTML for the content panel.
</objective>

<execution_context>
@/home/sam/.claude/get-shit-done/workflows/execute-plan.md
@/home/sam/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-interactions-content/06-RESEARCH.md

# Content data
@data/content.json.js
@data/talks.json
@data/publications.json
@data/media.json
@data/research.json

# Game code
@js/game/buildings.js
@js/game/world.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add talks data to SITE_CONTENT</name>
  <files>data/content.json.js</files>
  <action>
The current content.json.js has publications, media, research, about, and gameContent, but talks data is in a separate talks.json file. We need talks accessible in SITE_CONTENT.

Add a talks array to SITE_CONTENT in data/content.json.js. Import the data from talks.json (or copy it inline since this is a .js file loaded directly).

Add after the media array:

```javascript
talks: [
    {
        id: "cambridge-science-festival-2025",
        title: "AI and the Future of Wildlife Conservation",
        venue: "Cambridge Science Festival, Cambridge",
        date: "2025-03-15"
    },
    {
        id: "turing-institute-seminar",
        title: "Large Language Models for Evidence Synthesis in Conservation",
        venue: "Alan Turing Institute, London",
        date: "2025-02-12"
    },
    // ... include all 19 talks from talks.json
],
```

Copy all 19 talks from /data/talks.json into this array. Format dates as "Month YYYY" for display (or keep ISO format and we'll format in display logic).

Note: Keep dates in ISO format (YYYY-MM-DD) and format them during display.
  </action>
  <verify>
Run `grep -c "talks:" data/content.json.js` - should return 1
Run `grep -c "title.*Conservation\|title.*Wildlife\|title.*AI" data/content.json.js` - should return 15+ (talks have these keywords)
  </verify>
  <done>SITE_CONTENT.talks array exists with all 19 invited talks</done>
</task>

<task type="auto">
  <name>Task 2: Create content formatting methods in Buildings.js</name>
  <files>js/game/buildings.js</files>
  <action>
Add content formatting methods to Buildings object that transform SITE_CONTENT data into HTML for the panel.

Add these new methods:

1. formatPublicationsList() - Format all publications for panel display:
```javascript
formatPublicationsList() {
    const pubs = SITE_CONTENT.publications;
    return pubs.map(pub => `
        <div class="panel-item">
            <h4>${pub.title}</h4>
            <p class="authors">${pub.authors}</p>
            <p class="venue"><em>${pub.venue}</em> (${pub.year})</p>
            ${pub.links?.paper ? `<a href="${pub.links.paper}" target="_blank" rel="noopener" class="panel-link">View Paper</a>` : ''}
        </div>
    `).join('');
}
```

2. formatTalksList() - Format all talks:
```javascript
formatTalksList() {
    const talks = SITE_CONTENT.talks;
    return talks.map(talk => {
        const date = this.formatDate(talk.date);
        return `
            <div class="panel-item">
                <h4>${talk.title}</h4>
                <p class="venue">${talk.venue}</p>
                <p class="date">${date}</p>
                ${talk.video ? `<a href="${talk.video}" target="_blank" rel="noopener" class="panel-link">Watch Video</a>` : ''}
                ${talk.slides ? `<a href="${talk.slides}" target="_blank" rel="noopener" class="panel-link">View Slides</a>` : ''}
            </div>
        `;
    }).join('');
}
```

3. formatMediaList() - Format media appearances:
```javascript
formatMediaList() {
    const media = SITE_CONTENT.media;
    return media.map(item => `
        <div class="panel-item">
            <h4>${item.title}</h4>
            <p class="type-badge">${item.type.toUpperCase()}</p>
            <p class="venue">${item.venue}</p>
            <p class="description">${item.description}</p>
            <p class="date">${item.date}</p>
            ${item.link && item.link !== '#' ? `<a href="${item.link}" target="_blank" rel="noopener" class="panel-link">View</a>` : ''}
        </div>
    `).join('');
}
```

4. formatResearchList() - Format research projects:
```javascript
formatResearchList() {
    const research = SITE_CONTENT.research;
    return research.map(item => `
        <div class="panel-item">
            <h4>${item.title}</h4>
            <p class="description">${item.description}</p>
            <p class="tags">${item.tags.map(t => `<span class="tag">${t}</span>`).join(' ')}</p>
        </div>
    `).join('');
}
```

5. formatDate(isoDate) - Helper to format ISO dates:
```javascript
formatDate(isoDate) {
    if (!isoDate) return '';
    const date = new Date(isoDate);
    const months = ['January', 'February', 'March', 'April', 'May', 'June',
                    'July', 'August', 'September', 'October', 'November', 'December'];
    return `${months[date.getMonth()]} ${date.getFullYear()}`;
}
```

6. Update handleInteraction() to use panels for list types:

Modify the existing content display methods to use showContentPanel for full lists:

```javascript
// Add new method for showing full list panels
showPublicationsPanel() {
    const content = this.formatPublicationsList();
    this.showContentPanel('Publications', content);
}

showTalksPanel() {
    const content = this.formatTalksList();
    this.showContentPanel('Invited Talks', content);
}

showMediaPanel() {
    const content = this.formatMediaList();
    this.showContentPanel('Media & Appearances', content);
}

showResearchPanel() {
    const content = this.formatResearchList();
    this.showContentPanel('Research Projects', content);
}
```

Then update handleInteraction() cases to call these panel methods when appropriate.

For individual item interactions (index >= 0), keep using the existing dialog.
For "browse all" type interactions (index < 0 or special type), show the full panel.

Actually, looking at World.js, the interactions have specific indices. Let's make the first interaction point in each building show the full panel, and others show individual items.

Simpler approach: When interaction index is 0, show the full panel. Otherwise show individual item in dialog.

Update in handleInteraction():
```javascript
case 'publication':
    if (interaction.index === 0) {
        this.showPublicationsPanel();
    } else {
        this.showPublicationContent(interaction.index);
    }
    return { action: 'dialog' };

case 'talks':
    if (interaction.index === 0) {
        this.showTalksPanel();
    } else {
        this.showTalksContent(interaction.index);
    }
    return { action: 'dialog' };
```

Similar for 'media' and 'research' types.
  </action>
  <verify>
Run `grep -c "formatPublicationsList\|formatTalksList\|formatMediaList\|formatResearchList" js/game/buildings.js` - should return 4+
Run `grep "showContentPanel" js/game/buildings.js` - verify panel methods call it
  </verify>
  <done>
Buildings.js has:
- formatPublicationsList() returning HTML for all publications
- formatTalksList() returning HTML for all talks
- formatMediaList() returning HTML for all media items
- formatResearchList() returning HTML for all research projects
- Panel methods (showPublicationsPanel, etc.) that display full lists
- handleInteraction() wired to show panels for index 0 interactions
  </done>
</task>

<task type="auto">
  <name>Task 3: Add panel item CSS styles</name>
  <files>css/game.css</files>
  <action>
Add CSS styles for panel content items to css/game.css, after the content-panel styles added in Plan 01.

Add styles for:

```css
/* Panel content items */
.panel-item {
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.panel-item:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
}

.panel-item h4 {
    margin: 0 0 8px 0;
    color: #87ceeb;
    font-size: 1rem;
    line-height: 1.4;
}

.panel-item .authors,
.panel-item .venue {
    margin: 4px 0;
    font-size: 0.9rem;
    color: #bbb;
}

.panel-item .venue em {
    font-style: italic;
}

.panel-item .description {
    margin: 8px 0;
    font-size: 0.9rem;
    line-height: 1.5;
    color: #ddd;
}

.panel-item .date {
    margin: 4px 0;
    font-size: 0.85rem;
    color: #888;
}

.panel-item .type-badge {
    display: inline-block;
    background: var(--pixel-accent, #c84060);
    color: white;
    padding: 2px 8px;
    border-radius: 3px;
    font-size: 0.7rem;
    font-weight: bold;
    margin-bottom: 8px;
}

.panel-item .tags {
    margin-top: 8px;
}

.panel-item .tag {
    display: inline-block;
    background: rgba(135, 206, 235, 0.2);
    color: #87ceeb;
    padding: 2px 8px;
    border-radius: 3px;
    font-size: 0.75rem;
    margin-right: 6px;
    margin-bottom: 4px;
}

.panel-link {
    display: inline-block;
    margin-top: 8px;
    margin-right: 12px;
    color: #87ceeb;
    text-decoration: none;
    font-size: 0.85rem;
}

.panel-link:hover {
    text-decoration: underline;
}
```
  </action>
  <verify>
Run `grep -c "panel-item\|panel-link\|type-badge" css/game.css` - should return 10+
  </verify>
  <done>Panel item CSS styles exist for content display (items, links, tags, badges)</done>
</task>

</tasks>

<verification>
1. Game loads and works: `npm run dev`, press G
2. Enter Library, walk to bookshelf at position (5,2), press ENTER - should show Publications panel
3. Panel shows all 6 publications with title, authors, venue, year
4. Panel scrolls if content exceeds height
5. Close panel with ESC, walk to another bookshelf - should show individual publication dialog
6. Enter Theatre, interact with podium - should show Talks panel with all 19 talks
7. Enter Station, interact with control desk - should show Media panel
8. Enter Lab, interact with equipment - should show Research panel
</verification>

<success_criteria>
- SITE_CONTENT.talks array contains all 19 talks from talks.json
- Publications panel shows all publications formatted with title/authors/venue/year
- Talks panel shows all talks formatted with title/venue/date
- Media panel shows appearances with type badges
- Research panel shows projects with description and tags
- Links in panels open in new tabs
- Dates formatted as "Month Year"
</success_criteria>

<output>
After completion, create `.planning/phases/06-interactions-content/06-02-SUMMARY.md`
</output>
