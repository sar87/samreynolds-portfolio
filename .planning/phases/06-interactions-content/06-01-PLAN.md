---
phase: 06-interactions-content
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/game/CampusGame.ts
  - css/game.css
  - js/game/buildings.js
autonomous: true

must_haves:
  truths:
    - "Content panel overlay can be opened from game"
    - "Content panel displays scrollable content area"
    - "Content panel can be closed with ESC key or close button"
    - "Focus is trapped inside panel when open"
  artifacts:
    - path: "src/game/CampusGame.ts"
      provides: "Content panel DOM structure"
      contains: "content-panel"
    - path: "css/game.css"
      provides: "Content panel styling"
      contains: ".content-panel"
    - path: "js/game/buildings.js"
      provides: "Panel show/hide/focus trap logic"
      contains: "showContentPanel"
  key_links:
    - from: "js/game/buildings.js"
      to: "content-panel DOM"
      via: "document.getElementById"
      pattern: "getElementById.*content-panel"
    - from: "css/game.css"
      to: "content-panel"
      via: "CSS selector"
      pattern: "\\.content-panel"
---

<objective>
Create the expanded content panel overlay for displaying academic content (publications, talks, media, research).

Purpose: The existing dialog box is too small for content lists. A larger, scrollable panel overlay is needed to display full publications, talks, etc. with proper accessibility.

Output: New content panel DOM structure, CSS styling, and show/hide logic with focus trapping.
</objective>

<execution_context>
@/home/sam/.claude/get-shit-done/workflows/execute-plan.md
@/home/sam/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-interactions-content/06-RESEARCH.md

# Existing game code
@src/game/CampusGame.ts
@js/game/buildings.js
@css/game.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add content panel DOM structure to CampusGame.ts</name>
  <files>src/game/CampusGame.ts</files>
  <action>
Add content panel HTML to the createGameDOM() method in CampusGame.ts, after the dialog-box div.

Structure to add:
```html
<!-- Content Panel Overlay -->
<div id="content-panel" class="content-panel hidden" role="dialog" aria-modal="true" aria-labelledby="panel-title">
  <div class="panel-header">
    <h2 id="panel-title"></h2>
    <button id="panel-close" class="panel-close" aria-label="Close panel">&times;</button>
  </div>
  <div id="panel-body" class="panel-body">
    <!-- Content items populated dynamically -->
  </div>
  <div class="panel-footer">
    <span class="panel-hint">ESC or click &times; to close</span>
  </div>
</div>
```

Place this after the dialog-box div but before the loading-screen div.
  </action>
  <verify>
Run `grep -A5 "content-panel" src/game/CampusGame.ts` - should show the content panel structure
  </verify>
  <done>Content panel HTML structure exists in CampusGame.ts createGameDOM() method</done>
</task>

<task type="auto">
  <name>Task 2: Add content panel CSS styles</name>
  <files>css/game.css</files>
  <action>
Add content panel styles to css/game.css. Add after the existing dialog-box styles.

Key styling requirements:
1. Fixed position, centered (50% translate trick)
2. Width: 90%, max-width: 800px
3. Max-height: 80vh with flex column layout
4. Dark semi-transparent background matching game theme (rgba(26, 26, 46, 0.98))
5. Border: 3px solid matching dialog box (#4a4a6a or similar)
6. z-index: 250 (above dialog box z-index: 200)

Panel sections:
- .panel-header: flex row with title and close button, border-bottom
- .panel-body: flex: 1, overflow-y: auto, -webkit-overflow-scrolling: touch for iOS
- .panel-footer: border-top, hint text
- .panel-close: 32px button, no background, hover state
- .panel-item: Individual content items with spacing and border-bottom
- .content-panel.hidden: display: none

See 06-RESEARCH.md "Content Panel CSS" section for reference implementation.
  </action>
  <verify>
Run `grep -c "content-panel" css/game.css` - should return 5+ (multiple selectors)
  </verify>
  <done>Content panel CSS styles exist with proper positioning, scrolling, and theme matching</done>
</task>

<task type="auto">
  <name>Task 3: Add panel show/hide logic with focus trapping to Buildings.js</name>
  <files>js/game/buildings.js</files>
  <action>
Add content panel management methods to Buildings object in js/game/buildings.js.

Add these properties at top of Buildings object:
- panelOpen: false
- panelElement: null
- panelTitle: null
- panelBody: null
- panelCloseBtn: null
- previousFocus: null (for focus restoration)

Modify init() to also grab panel elements:
```javascript
this.panelElement = document.getElementById('content-panel');
this.panelTitle = document.getElementById('panel-title');
this.panelBody = document.getElementById('panel-body');
this.panelCloseBtn = document.getElementById('panel-close');

// Panel close button click
if (this.panelCloseBtn) {
    this.panelCloseBtn.addEventListener('click', () => this.closePanel());
}

// ESC key handling for panel
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && this.panelOpen) {
        this.closePanel();
    }
});
```

Add new methods:

1. showContentPanel(title, htmlContent):
   - Save document.activeElement to previousFocus
   - Set panelTitle.textContent = title
   - Set panelBody.innerHTML = htmlContent
   - Remove 'hidden' class from panelElement
   - Set panelOpen = true
   - Call trapFocus(panelElement)

2. closePanel():
   - Add 'hidden' class to panelElement
   - Set panelOpen = false
   - Restore focus: if (previousFocus) previousFocus.focus()

3. trapFocus(element):
   - Find all focusable elements inside panel
   - Focus first focusable element (close button)
   - Add keydown listener for Tab key cycling

4. isPanelOpen():
   - Return this.panelOpen

Important: Update the existing update() check in Engine.js to also check isPanelOpen() - but this is just awareness, Player.update() already returns early when Buildings.isDialogOpen(). We need to ensure panel also blocks movement.

Actually, check Engine.js update() - it uses Buildings.isDialogOpen(). We should update that check OR make isDialogOpen() return true when panel is open as well.

Simplest fix: In isDialogOpen(), return `this.dialogOpen || this.panelOpen`.
  </action>
  <verify>
Run `grep -c "showContentPanel\|closePanel\|trapFocus\|panelOpen" js/game/buildings.js` - should return 10+ matches
Run `grep "isDialogOpen" js/game/buildings.js` - verify it checks panelOpen
  </verify>
  <done>
Buildings.js has:
- showContentPanel() method that opens panel with HTML content
- closePanel() method that closes and restores focus
- trapFocus() method for accessibility
- isDialogOpen() returns true for both dialog and panel
  </done>
</task>

</tasks>

<verification>
1. Game still loads and runs: `npm run dev`, press G to enter game
2. Content panel elements exist in DOM: browser devtools, search for "content-panel"
3. Panel can be shown: In browser console, run `Buildings.showContentPanel('Test', '<p>Hello</p>')` - panel should appear
4. Panel can be closed: Press ESC or click X - panel should close
5. Focus trap works: Tab through panel elements, focus stays inside
6. Movement blocked: While panel open, arrow keys should not move player
</verification>

<success_criteria>
- Content panel overlay HTML exists in game DOM
- Panel styled to match game theme (dark, bordered, centered)
- Panel opens with showContentPanel(title, content)
- Panel closes with ESC key, X button, or closePanel()
- Focus trapped inside panel when open
- Player movement blocked when panel is open
</success_criteria>

<output>
After completion, create `.planning/phases/06-interactions-content/06-01-SUMMARY.md`
</output>
