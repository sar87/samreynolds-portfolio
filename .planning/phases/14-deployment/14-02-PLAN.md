---
phase: 14-deployment
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - vite.config.ts
  - .github/workflows/deploy.yml
autonomous: true

must_haves:
  truths:
    - "Production build succeeds with correct base path for GitHub Pages"
    - "GitHub Actions workflow exists and will trigger on push to main"
    - "Local preview with base path serves all assets correctly"
    - "Vite config uses environment variable to conditionally set base path"
  artifacts:
    - path: "vite.config.ts"
      provides: "GitHub Pages base path configuration"
      contains: "GITHUB_PAGES"
    - path: ".github/workflows/deploy.yml"
      provides: "Automated GitHub Pages deployment pipeline"
      contains: "deploy-pages"
  key_links:
    - from: "vite.config.ts"
      to: ".github/workflows/deploy.yml"
      via: "GITHUB_PAGES env variable sets base path during build"
      pattern: "GITHUB_PAGES"
    - from: ".github/workflows/deploy.yml"
      to: "GitHub Pages"
      via: "actions/deploy-pages@v4"
      pattern: "deploy-pages"
---

<objective>
Configure Vite for GitHub Pages deployment and create the CI/CD workflow.

Purpose: DEPLOY-02 requires GitHub Pages deployment to build and serve without errors. The site currently has no deployment configuration - no base path handling, no GitHub Actions workflow. This plan adds the base path configuration to vite.config.ts (conditional on GITHUB_PAGES env var) and creates a GitHub Actions workflow that builds and deploys on push to main.

Output: Updated vite.config.ts with base path, new .github/workflows/deploy.yml file.
</objective>

<execution_context>
@/home/sam/.claude/get-shit-done/workflows/execute-plan.md
@/home/sam/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-deployment/14-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Vite base path and GitHub Actions deployment workflow</name>
  <files>vite.config.ts, .github/workflows/deploy.yml</files>
  <action>
**vite.config.ts:** Update to add conditional base path for GitHub Pages. The repository name is "Website" based on the directory name and git config. Use an environment variable so local dev stays on `/` while CI builds use `/Website/`.

Replace the existing vite.config.ts with:
```typescript
import { defineConfig } from 'vite';

export default defineConfig({
  // Base path: '/' for local dev, '/Website/' for GitHub Pages
  base: process.env.GITHUB_PAGES ? '/Website/' : '/',

  // Server configuration
  server: {
    port: 5173,
    open: true,
  },

  // Build configuration
  build: {
    outDir: 'dist',
    sourcemap: true,
    target: 'es2022',
    // CSS and JS minification for production
    minify: 'esbuild',
    cssMinify: true,
  },

  // Asset handling
  assetsInclude: ['**/*.png', '**/*.json'],
});
```

**IMPORTANT:** The repo name "Website" is assumed from the project directory. If the actual GitHub repo name differs, the base path will need to be updated. Alternatively, if this ends up as a user/org site (username.github.io), the base should stay as `/`.

**.github/workflows/deploy.yml:** Create the GitHub Actions workflow for automated deployment.

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches: ['main']
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: 'pages'
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build
        run: npm run build
        env:
          GITHUB_PAGES: true

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: './dist'

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

Before creating the workflow file, ensure the `.github/workflows/` directory exists by creating it first.
  </action>
  <verify>
1. Run `npm run build` to verify build succeeds without the GITHUB_PAGES env var (base should be '/')
2. Run `GITHUB_PAGES=true npm run build` to verify build succeeds with GitHub Pages base path
3. Run `npm run preview` and verify site loads at http://localhost:4173
4. Check the built index.html in dist/ to confirm asset paths:
   - Without GITHUB_PAGES: paths like `/assets/main-xxx.js`
   - With GITHUB_PAGES: paths like `/Website/assets/main-xxx.js`
5. Verify `.github/workflows/deploy.yml` exists and has valid YAML structure
  </verify>
  <done>
Vite config conditionally sets base path to `/Website/` when GITHUB_PAGES=true. GitHub Actions workflow deploys on push to main branch using official GitHub Pages actions. Local development unaffected (base remains `/`). Build succeeds in both configurations.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify production build and local preview</name>
  <files>vite.config.ts</files>
  <action>
Run a comprehensive production build verification:

1. Clean the dist directory if it exists: `rm -rf dist/`
2. Run `npm run build` (standard build, base: '/')
3. Verify the build output:
   - `dist/index.html` exists
   - `dist/assets/` directory contains JS and CSS files
   - No build warnings or errors
4. Run `npm run preview` in background and verify the site loads
5. Kill the preview server
6. Run `GITHUB_PAGES=true npm run build` (GitHub Pages build, base: '/Website/')
7. Check `dist/index.html` - asset paths should start with `/Website/`
8. Run `npx vite preview --base=/Website/` to verify the GitHub Pages build serves correctly

If any video files referenced in the HTML (hero-video.mp4, etc.) are in the public/ directory, verify they are included in the dist output. If they are not in public/, note this as a concern for deployment (videos would need to be in public/ to be served).

Check that the `public/` directory contains all referenced static assets:
- hero-video.mp4
- mushroom-banner.mp4, murmuration-banner.mp4, woolshark-banner.mp4, acorns-banner.mp4
- images/profile.jpg, images/nature-reviews.jpg, images/nature-comment.png

If any assets are missing from public/, note which ones in the summary.
  </action>
  <verify>
1. `npm run build` exits with code 0
2. `GITHUB_PAGES=true npm run build` exits with code 0
3. `dist/index.html` contains correct asset paths for both build modes
4. Production preview serves the site without console errors
5. All public/ assets are present in dist/ after build
  </verify>
  <done>
Production build verified in both local and GitHub Pages configurations. Asset paths are correct. Public directory assets are confirmed present in build output (or missing assets are documented).
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes (local config)
2. `GITHUB_PAGES=true npm run build` passes (deployment config)
3. Asset paths in dist/index.html are correct for each mode
4. `.github/workflows/deploy.yml` is valid YAML with correct structure
5. Preview server loads site without errors
6. All static assets (videos, images) included in build output
</verification>

<success_criteria>
- vite.config.ts conditionally sets base path using GITHUB_PAGES environment variable
- GitHub Actions workflow file exists at .github/workflows/deploy.yml
- Workflow triggers on push to main and workflow_dispatch
- Production build succeeds in both local and GitHub Pages modes
- Local preview serves site correctly
- No build errors or warnings
</success_criteria>

<output>
After completion, create `.planning/phases/14-deployment/14-02-SUMMARY.md`
</output>
