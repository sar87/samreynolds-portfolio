---
phase: 07-landing-mode-switching
plan: 03
type: execute
wave: 2
depends_on: ["07-01", "07-02"]
files_modified:
  - src/main.ts
  - src/components/Landing/Landing.ts
  - src/components/Landing/Landing.css
autonomous: true

must_haves:
  truths:
    - "Landing shows on first visit in session"
    - "Returning visits (same session) skip landing and go to last mode"
    - "Clicking Enter Website triggers expand animation and loads website"
    - "Clicking Enter Game triggers expand animation, shows loading, starts game"
    - "Skip-to-content links load website mode and scroll to section"
  artifacts:
    - path: "src/main.ts"
      provides: "Landing route and mode transition logic"
      contains: "sessionStorage"
    - path: "src/components/Landing/Landing.ts"
      provides: "Updated with preview integration and skip links"
      contains: "skip-link"
  key_links:
    - from: "src/main.ts"
      to: "src/components/Landing/Landing.ts"
      via: "import renderLanding"
      pattern: "import.*renderLanding"
    - from: "src/components/Landing/Landing.ts"
      to: "src/components/Landing/GamePreview.ts"
      via: "import preview functions"
      pattern: "import.*GamePreview"
    - from: "src/main.ts"
      to: "src/components/Landing/LoadingScreen.ts"
      via: "import loading functions"
      pattern: "import.*LoadingScreen"
---

<objective>
Wire landing component into router with session tracking, expand animations, and skip-to-content links.

Purpose: Complete the landing experience with proper navigation flow and transitions
Output: Fully functional landing that transitions smoothly to either mode
</objective>

<execution_context>
@/home/sam/.claude/get-shit-done/workflows/execute-plan.md
@/home/sam/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/07-landing-mode-switching/07-CONTEXT.md
@.planning/phases/07-landing-mode-switching/07-RESEARCH.md
@src/main.ts
@src/lib/router.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add skip links and integrate preview into Landing component</name>
  <files>src/components/Landing/Landing.ts, src/components/Landing/Landing.css</files>
  <action>
Update Landing.ts:

1. **Import preview functions:**
   ```typescript
   import { createGamePreview, startPreviewAnimation, stopPreviewAnimation } from './GamePreview';
   ```

2. **Add skip-to-content links** in the footer area:
   - Links: Publications, Talks, Media, Research, About
   - Each link: `<a href="#publications" class="skip-link" data-section="publications">Publications</a>`
   - Use inline SVG icons (simple book, mic, tv, beaker, person silhouettes)
   - Links are visible in footer (not hidden-until-focus pattern - that's for accessibility skip, these are navigation)

3. **Replace game preview placeholder** with actual preview canvas:
   - Use createGamePreview() for the canvas HTML
   - Export initLanding() function that starts the animation after render

4. **Add expand animation classes:**
   - .landing-half.expanding: transform scale(1.02), higher z-index
   - .landing-half.fading: opacity 0, transform scale(0.98), pointer-events none
   - .landing.transitioning: overflow hidden

5. **Export initLanding()** function that:
   - Finds the preview canvas and starts animation
   - Returns cleanup function that stops animation

Update Landing.css:
- Add .expanding and .fading transition states
- Style skip links in footer: horizontal row, icons + text, hover states
- Ensure transitions use --transition-expand and --transition-fade
  </action>
  <verify>
grep "import.*GamePreview" src/components/Landing/Landing.ts
grep "export.*initLanding" src/components/Landing/Landing.ts
grep "skip-link" src/components/Landing/Landing.ts
grep ".landing-half.expanding" src/components/Landing/Landing.css
  </verify>
  <done>
Landing component updated with:
- Game preview canvas integrated
- Skip-to-content links in footer
- Expand/fade animation classes
- initLanding() for animation lifecycle
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire landing into main.ts with session tracking and transitions</name>
  <files>src/main.ts</files>
  <action>
Update main.ts:

1. **Add imports at top:**
   ```typescript
   import './components/Landing/Landing.css';
   import './components/Landing/LoadingScreen.css';
   import { renderLanding, initLanding } from './components/Landing/Landing';
   import { showLoadingScreen, hideLoadingScreen } from './components/Landing/LoadingScreen';
   ```

2. **Add session tracking:**
   ```typescript
   // Check if landing has been shown this session
   const landingShown = sessionStorage.getItem('landing-shown') === 'true';
   let currentMode: 'landing' | 'website' | 'game' = landingShown ? 'website' : 'landing';
   ```

3. **Update root route handler:**
   - If currentMode is 'landing', render landing page (not header/content structure)
   - Call initLanding() after render to start preview animation
   - Add click handlers for mode buttons and skip links

4. **Create mode transition functions:**

   ```typescript
   async function transitionToMode(mode: 'website' | 'game', skipSection?: string): Promise<void> {
     // Add expanding class to chosen half, fading to other
     const chosen = document.querySelector(`.landing-half--${mode}`);
     const other = document.querySelector(`.landing-half--${mode === 'website' ? 'game' : 'website'}`);

     chosen?.classList.add('expanding');
     other?.classList.add('fading');

     // Wait for animation (250ms)
     await new Promise(r => setTimeout(r, 250));

     // Mark landing as shown
     sessionStorage.setItem('landing-shown', 'true');
     currentMode = mode;

     if (mode === 'game') {
       showLoadingScreen();
       await enterGameMode();
       hideLoadingScreen();
     } else {
       await render(renderHomePage());
       if (skipSection) {
         // Scroll to section after render
         setTimeout(() => {
           const section = document.getElementById(skipSection);
           section?.scrollIntoView({ behavior: 'smooth' });
         }, 100);
       }
     }
   }
   ```

5. **Add landing event handlers** after rendering landing:
   ```typescript
   // Mode button clicks
   document.querySelectorAll('[data-mode]').forEach(btn => {
     btn.addEventListener('click', () => {
       const mode = btn.getAttribute('data-mode') as 'website' | 'game';
       transitionToMode(mode);
     });
   });

   // Skip link clicks
   document.querySelectorAll('[data-section]').forEach(link => {
     link.addEventListener('click', (e) => {
       e.preventDefault();
       const section = link.getAttribute('data-section');
       transitionToMode('website', section || undefined);
     });
   });
   ```

6. **Update G key handler** to handle landing state:
   - If on landing, pressing G should trigger game mode transition
   - Keep existing toggle behavior for game/website modes
  </action>
  <verify>
grep "sessionStorage.*landing-shown" src/main.ts
grep "import.*renderLanding" src/main.ts
grep "import.*showLoadingScreen" src/main.ts
grep "transitionToMode" src/main.ts
  </verify>
  <done>
main.ts updated with:
- Landing shown on first session visit
- Session tracking prevents repeated landing
- Expand animation on mode selection
- Loading screen for game mode
- Skip links navigate to website sections
- G key works from landing
  </done>
</task>

</tasks>

<verification>
1. First visit shows landing page
2. Refresh (same session) goes directly to website
3. Clicking "Enter Website" shows expand animation, loads website
4. Clicking "Enter Game" shows expand animation, loading screen, starts game
5. Skip links load website and scroll to section
6. G key from landing enters game mode
7. npm run dev serves without errors
</verification>

<success_criteria>
- Landing appears on first session visit only
- Mode transitions have smooth expand/fade animations
- Game loading shows progress indicator
- Skip links provide direct section access
- All navigation paths work correctly
</success_criteria>

<output>
After completion, create `.planning/phases/07-landing-mode-switching/07-03-SUMMARY.md`
</output>
