---
phase: 07-landing-mode-switching
plan: 04
type: execute
wave: 3
depends_on: ["07-03"]
files_modified:
  - src/components/Header/Header.ts
  - src/components/Header/Header.css
  - js/game/Buildings.js
  - css/main.css
autonomous: true

must_haves:
  truths:
    - "Website mode shows 'Play Game' button in header"
    - "Game mode shows 'View Website' button in HUD"
    - "Clicking toggle buttons switches modes directly (no landing)"
    - "Transition is smooth with appropriate animation"
  artifacts:
    - path: "src/components/Header/Header.ts"
      provides: "Header with mode toggle button"
      contains: "mode-toggle"
    - path: "js/game/Buildings.js"
      provides: "Game HUD with website toggle"
      contains: "mode-toggle"
  key_links:
    - from: "src/components/Header/Header.ts"
      to: "src/main.ts"
      via: "dispatches custom event"
      pattern: "dispatchEvent|CustomEvent"
    - from: "js/game/Buildings.js"
      to: "window"
      via: "dispatches custom event"
      pattern: "dispatchEvent|CustomEvent"
---

<objective>
Add mode toggle buttons to website header and game HUD for direct switching between modes.

Purpose: Allow users to switch modes without returning to landing (per CONTEXT.md decision)
Output: Toggle buttons in both modes that switch directly to the other
</objective>

<execution_context>
@/home/sam/.claude/get-shit-done/workflows/execute-plan.md
@/home/sam/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/07-landing-mode-switching/07-CONTEXT.md
@src/components/Header/Header.ts
@src/components/Header/Header.css
@js/game/Buildings.js
@css/main.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add mode toggle button to website Header</name>
  <files>src/components/Header/Header.ts, src/components/Header/Header.css</files>
  <action>
Update Header.ts:

1. **Add toggle button to header** in renderHeader():
   - Place after the navigation links, before mobile hamburger
   - Button text: "Play Game" with small game controller or joystick icon (inline SVG)
   - Class: "mode-toggle mode-toggle--game"
   - Visually distinct from nav links (button style, accent color)

2. **Add click handler in initMobileNav()** (or create separate init function):
   - Button click dispatches custom event: `window.dispatchEvent(new CustomEvent('mode-switch', { detail: { mode: 'game' } }))`
   - Do NOT handle navigation here - main.ts will listen for this event

Update Header.css:
- Style .mode-toggle as a button: background accent, white text, small padding
- Hover state: darker accent
- Position: right side of header, before hamburger on mobile
- Hide text on mobile (icon only): @media (max-width: 768px) span { display: none }
  </action>
  <verify>
grep "mode-toggle" src/components/Header/Header.ts
grep "mode-switch" src/components/Header/Header.ts
grep ".mode-toggle" src/components/Header/Header.css
  </verify>
  <done>
Header updated with:
- "Play Game" toggle button
- Custom event dispatch on click
- Responsive styling (icon-only on mobile)
  </done>
</task>

<task type="auto">
  <name>Task 2: Add mode toggle button to game HUD and wire events in main.ts</name>
  <files>js/game/Buildings.js, css/main.css, src/main.ts</files>
  <action>
Update Buildings.js:

1. **Add HUD toggle button** in the location HUD area (or create new HUD element):
   - When game initializes, create a "View Website" button in the game-container
   - Position: top-right corner of game viewport
   - Style: semi-transparent button with website icon
   - On click: `window.dispatchEvent(new CustomEvent('mode-switch', { detail: { mode: 'website' } }))`

2. **Create the button element** in Buildings.init() or similar initialization point:
   ```javascript
   const modeToggle = document.createElement('button');
   modeToggle.className = 'game-mode-toggle';
   modeToggle.innerHTML = '<svg>...</svg> Website';
   modeToggle.addEventListener('click', () => {
     window.dispatchEvent(new CustomEvent('mode-switch', { detail: { mode: 'website' } }));
   });
   document.getElementById('game-container')?.appendChild(modeToggle);
   ```

Update css/main.css:
- Add .game-mode-toggle styles: position absolute, top-right, semi-transparent bg, white text
- Hover: more opaque
- z-index above game canvas but below panels (z-index: 100)

Update main.ts:

1. **Add event listener for mode-switch**:
   ```typescript
   window.addEventListener('mode-switch', ((e: CustomEvent) => {
     const targetMode = e.detail.mode as 'website' | 'game';
     if (targetMode === 'game' && !game) {
       // From website to game
       showLoadingScreen();
       enterGameMode().then(() => hideLoadingScreen());
     } else if (targetMode === 'website' && game) {
       // From game to website
       exitGameMode();
       router.navigate('/');
     }
   }) as EventListener);
   ```

2. Ensure this works regardless of landing state (currentMode tracking)
  </action>
  <verify>
grep "game-mode-toggle" js/game/Buildings.js
grep "mode-switch" js/game/Buildings.js
grep ".game-mode-toggle" css/main.css
grep "mode-switch" src/main.ts
  </verify>
  <done>
Mode toggle complete with:
- Game HUD has "View Website" button
- Both buttons dispatch mode-switch event
- main.ts handles event to switch modes
- Transitions are smooth (loading screen for game entry)
  </done>
</task>

</tasks>

<verification>
1. Website header shows "Play Game" button
2. Clicking "Play Game" shows loading, enters game
3. Game HUD shows "View Website" button (top-right)
4. Clicking "View Website" exits game, shows website
5. No return to landing when switching modes
6. npm run dev serves without errors
</verification>

<success_criteria>
- Both modes have visible toggle button
- Switching modes is direct (no landing)
- Transitions include appropriate feedback (loading for game)
- G key still works as shortcut
</success_criteria>

<output>
After completion, create `.planning/phases/07-landing-mode-switching/07-04-SUMMARY.md`
</output>
