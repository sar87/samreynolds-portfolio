---
phase: 03-website-mode
plan: 04
type: execute
wave: 4
depends_on: ["03-01", "03-02", "03-03"]
files_modified:
  - src/main.ts
  - index.html
autonomous: false

must_haves:
  truths:
    - "Website loads and displays home page on initial visit"
    - "Navigation links scroll to sections on home page"
    - "Clicking card navigates to detail page"
    - "Back link from detail returns to home"
    - "Mobile navigation works"
    - "Site is visually responsive"
  artifacts:
    - path: "src/main.ts"
      provides: "App initialization with routing"
      contains: "router.init"
    - path: "index.html"
      provides: "Updated entry point with Inter font and minimal markup"
      contains: "rsms.me/inter"
  key_links:
    - from: "src/main.ts"
      to: "src/lib/router.ts"
      via: "router import and init"
      pattern: "import.*router.*from"
    - from: "src/main.ts"
      to: "src/pages/HomePage.ts"
      via: "page rendering"
      pattern: "renderHomePage"
    - from: "src/main.ts"
      to: "src/components/Header/Header.ts"
      via: "header rendering"
      pattern: "renderHeader"
---

<objective>
Wire everything together: update main.ts to initialize routing and render pages, update index.html with proper Inter font loading and minimal markup for the website mode.

Purpose: This is the integration step that connects all the pieces. The website becomes functional with routing between home page and detail pages, responsive navigation, and proper font loading.

Output: Fully functional website mode that can be tested end-to-end.
</objective>

<execution_context>
@/home/sam/.claude/get-shit-done/workflows/execute-plan.md
@/home/sam/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-website-mode/03-CONTEXT.md
@.planning/phases/03-website-mode/03-RESEARCH.md

# All files from prior plans
@src/lib/router.ts
@src/lib/content.ts
@src/components/Header/Header.ts
@src/pages/HomePage.ts
@src/pages/PublicationDetail.ts
@src/pages/TalkDetail.ts
@src/pages/MediaDetail.ts
@src/styles/global.css
@src/styles/variables.css

# Current files to update
@src/main.ts
@index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update index.html for Website Mode</name>
  <files>
    index.html
  </files>
  <action>
Update index.html to support the new website mode:

1. **Add Inter font preconnect and stylesheet in head:**
```html
<link rel="preconnect" href="https://rsms.me/">
<link rel="stylesheet" href="https://rsms.me/inter/inter.css">
```

2. **Remove old CSS links** (css/main.css, css/normal.css, css/game.css) - we'll use the new CSS modules via Vite.

3. **Import new CSS in head or via main.ts:**
The new CSS files (variables.css, global.css, utilities.css) should be imported via main.ts, not linked directly. This lets Vite bundle them properly.

4. **Simplify body markup for website mode:**
Keep the game mode container hidden for now (Phase 4+ will use it). Create a minimal app container:
```html
<body>
  <!-- Website Mode -->
  <div id="app"></div>

  <!-- Game Mode (hidden, for future phases) -->
  <div id="game-mode" class="hidden">
    <!-- Keep existing game markup for Phase 4 -->
  </div>

  <script type="module" src="/src/main.ts"></script>
</body>
```

5. **Remove old normal-mode container** - the new website will be rendered into #app by JavaScript.

6. **Keep game-mode container** but ensure it has `class="hidden"` and `style="display:none"` for now.

7. **Update title and meta description** to match the current version but ensure they're appropriate.

Note: The existing index.html has both game and normal mode. For Phase 3, we're building the website into #app. The game mode markup stays but is hidden - Phase 4+ will reactivate it.
  </action>
  <verify>
```bash
npm run dev
```
Page loads without 404 errors, Inter font loads from rsms.me (check Network tab).
  </verify>
  <done>
index.html has Inter font preconnect, minimal #app container, game mode hidden.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire Main Entry Point</name>
  <files>
    src/main.ts
  </files>
  <action>
Rewrite src/main.ts to initialize the website:

```typescript
// Import styles
import './styles/variables.css';
import './styles/global.css';
import './styles/utilities.css';

// Import router and pages
import { router } from './lib/router';
import { renderHeader, initMobileNav } from './components/Header/Header';
import { renderHomePage } from './pages/HomePage';
import { renderPublicationDetail } from './pages/PublicationDetail';
import { renderTalkDetail } from './pages/TalkDetail';
import { renderMediaDetail } from './pages/MediaDetail';

// Get app container
const app = document.getElementById('app');
if (!app) throw new Error('App container not found');

// Render function that updates app content
async function render(content: string | Promise<string>): Promise<void> {
  const html = await content;
  // Keep header persistent, only update main content
  const headerHtml = renderHeader();
  app.innerHTML = `${headerHtml}<div id="content">${html}</div>`;
  initMobileNav();

  // Scroll to top on route change (unless it's a hash anchor)
  if (!window.location.hash.includes('#/') || window.location.hash === '#/') {
    window.scrollTo(0, 0);
  }
}

// Save scroll position before navigating away from home
let homeScrollPosition = 0;
function saveScrollPosition(): void {
  if (router.getCurrentPath() === '/' || router.getCurrentPath() === '') {
    homeScrollPosition = window.scrollY;
  }
}

// Register routes
router.add('/', async () => {
  await render(renderHomePage());
  // Restore scroll position if returning to home
  if (homeScrollPosition > 0) {
    window.scrollTo(0, homeScrollPosition);
    homeScrollPosition = 0;
  }
});

router.add('/publication/:id', async (params) => {
  saveScrollPosition();
  await render(renderPublicationDetail(params.id));
});

router.add('/talk/:id', async (params) => {
  saveScrollPosition();
  await render(renderTalkDetail(params.id));
});

router.add('/media/:id', async (params) => {
  saveScrollPosition();
  await render(renderMediaDetail(params.id));
});

// Handle anchor navigation on home page
document.addEventListener('click', (e) => {
  const target = e.target as HTMLElement;
  const link = target.closest('a');
  if (!link) return;

  const href = link.getAttribute('href');
  if (!href) return;

  // Handle section anchors (e.g., #about, #publications)
  if (href.startsWith('#') && !href.startsWith('#/')) {
    // If we're on home page, smooth scroll
    if (router.getCurrentPath() === '/' || router.getCurrentPath() === '') {
      e.preventDefault();
      const sectionId = href.slice(1);
      const section = document.getElementById(sectionId);
      if (section) {
        section.scrollIntoView({ behavior: 'smooth' });
        // Update URL without triggering route change
        history.pushState(null, '', href);
      }
    } else {
      // If on detail page, navigate home then scroll
      e.preventDefault();
      router.navigate('/');
      // Wait for render then scroll
      setTimeout(() => {
        const sectionId = href.slice(1);
        const section = document.getElementById(sectionId);
        if (section) {
          section.scrollIntoView({ behavior: 'smooth' });
        }
      }, 100);
    }
  }
});

// Initialize router
router.init();
```

Key features:
- CSS imports at top (Vite handles bundling)
- Header rendered persistently on all pages
- Routes for home + all detail pages
- Scroll position preservation for home page
- Section anchor navigation handled (smooth scroll on home, navigate-then-scroll from detail)
- Mobile nav initialized after each render
  </action>
  <verify>
```bash
npx tsc --noEmit && npm run dev
```
- Home page loads at localhost:5173
- Click publication card -> goes to detail page
- Click back -> returns to home
- Click nav link -> scrolls to section
- Mobile hamburger works
  </verify>
  <done>
Main entry wires router, renders pages, handles navigation between home and detail pages.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Visual and Functional Verification</name>
  <what-built>
Complete website mode with:
- Inter font and monochrome + teal design system
- Header with responsive navigation (desktop links, mobile hamburger)
- Home page with About, Research, Publications (15), Talks (19), Media (12) sections
- Card grid layouts responsive to viewport
- Detail pages for publications (abstract, DOI), talks (video/slides), media (description, link)
- Hash-based routing between pages
  </what-built>
  <how-to-verify>
1. **Start dev server:** `npm run dev`
2. **Open browser:** http://localhost:5173

**Desktop verification (wide viewport):**
3. Verify header shows "Sam Reynolds" logo and navigation links
4. Scroll through all 5 sections - verify content displays correctly
5. Check publications are in 2-column grid with 15 cards
6. Check talks section has 19 cards
7. Click a publication card -> verify detail page shows abstract and DOI link
8. Click "Back to Home" -> verify returns to home page
9. Verify header nav links scroll to correct sections

**Mobile verification (narrow viewport ~375px):**
10. Resize browser or use DevTools mobile view
11. Verify hamburger menu appears instead of nav links
12. Tap hamburger -> verify menu opens with links
13. Tap a link -> verify menu closes and scrolls to section
14. Verify cards stack in single column

**Typography and styling:**
15. Verify Inter font is loaded (check font in DevTools)
16. Verify teal accent color on links and card hover states
17. Verify clean, minimal aesthetic similar to Linear.app reference

**Accessibility quick check:**
18. Tab through header nav - can you see focus?
19. Press Escape with hamburger menu open - does it close?
  </how-to-verify>
  <resume-signal>Type "approved" if everything looks good, or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. Dev server runs: `npm run dev`
3. All routes work:
   - `#/` or empty -> home page
   - `#/publication/[id]` -> publication detail
   - `#/talk/[id]` -> talk detail
   - `#/media/[id]` -> media detail
   - Invalid routes -> redirect to home
4. Navigation:
   - Header nav scrolls to sections on home
   - Card clicks navigate to detail
   - Back links return to home
5. Responsive:
   - Desktop: 2-column cards, horizontal nav
   - Mobile: 1-column cards, hamburger menu
</verification>

<success_criteria>
- [ ] Inter font loads from rsms.me
- [ ] Home page displays all 5 sections with real content
- [ ] 15 publication cards, 19 talk cards, 12 media cards visible
- [ ] Card grid responsive (2 col desktop, 1 col mobile)
- [ ] Detail pages display full content with back link
- [ ] Header navigation scrolls to sections
- [ ] Mobile hamburger menu works with keyboard
- [ ] Teal accent color visible on links and hover states
- [ ] Clean, minimal aesthetic matches Linear.app inspiration
- [ ] No console errors
- [ ] Human verification approved
</success_criteria>

<output>
After completion, create `.planning/phases/03-website-mode/03-04-SUMMARY.md`
</output>
