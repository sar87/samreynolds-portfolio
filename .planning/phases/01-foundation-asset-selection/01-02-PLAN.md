---
phase: 01-foundation-asset-selection
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/config/engine.ts
  - src/utils/sprites.ts
  - src/main.ts
autonomous: false

must_haves:
  truths:
    - "32x32 tiles render at 2x scale (64px displayed)"
    - "Player sprite loads and displays correctly"
    - "Sample terrain tile renders at correct size"
    - "No visual artifacts or scaling issues"
  artifacts:
    - path: "src/config/engine.ts"
      provides: "Engine configuration with 32x32 tile size"
      contains: "tileSize"
    - path: "src/utils/sprites.ts"
      provides: "Sprite loading utilities"
      exports: ["loadSpriteSheet"]
  key_links:
    - from: "src/main.ts"
      to: "src/utils/sprites.ts"
      via: "import loadSpriteSheet"
      pattern: "import.*sprites"
    - from: "src/main.ts"
      to: "assets/sprites/characters/player.png"
      via: "loadSpriteSheet call"
      pattern: "loadSpriteSheet.*player"
---

<objective>
Integrate LPC sprites with the development environment and verify correct rendering at 32x32 tile scale.

Purpose: Confirm the asset pipeline works end-to-end before building the game engine in Phase 4.
Output: Working sprite loading, correct tile sizing, visual verification of LPC assets.
</objective>

<execution_context>
@/home/sam/.claude/get-shit-done/workflows/execute-plan.md
@/home/sam/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-asset-selection/01-RESEARCH.md
@.planning/phases/01-foundation-asset-selection/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Engine Configuration and Sprite Utilities</name>
  <files>
    src/config/engine.ts
    src/utils/sprites.ts
  </files>
  <action>
Create TypeScript modules for engine configuration and sprite loading:

**src/config/engine.ts:**
```typescript
export const EngineConfig = {
    // LPC uses 32x32 tiles (updated from 16x16)
    tileSize: 32,

    // Scale factor for rendering (2x = 64px displayed tiles)
    scale: 2,

    // Calculated rendered tile size
    get renderedTileSize() {
        return this.tileSize * this.scale;
    }
};
```

**src/utils/sprites.ts:**
```typescript
export async function loadSpriteSheet(path: string): Promise<HTMLImageElement> {
    return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => resolve(img);
        img.onerror = () => reject(new Error(`Failed to load sprite: ${path}`));
        img.src = path;
    });
}

// LPC character sprite extraction
// Characters are 64x64 per frame in standard LPC sheets
export function getCharacterFrame(
    direction: 'down' | 'left' | 'right' | 'up',
    frame: number
): { row: number; col: number; width: number; height: number } {
    // LPC walk cycle: row 8-11 (down, left, right, up), 9 frames each
    const directionRow: Record<string, number> = {
        down: 10,
        left: 9,
        right: 11,
        up: 8
    };

    return {
        row: directionRow[direction],
        col: frame % 9,
        width: 64,
        height: 64
    };
}

// Extract a single tile from a tileset
export function getTile(
    tileX: number,
    tileY: number,
    tileSize: number = 32
): { sx: number; sy: number; sw: number; sh: number } {
    return {
        sx: tileX * tileSize,
        sy: tileY * tileSize,
        sw: tileSize,
        sh: tileSize
    };
}
```

Note: The character frame positions are based on standard LPC sprite sheet layout. Verify against actual downloaded sheet and adjust if needed.
  </action>
  <verify>
    - `src/config/engine.ts` exports EngineConfig with tileSize: 32, scale: 2
    - `src/utils/sprites.ts` exports loadSpriteSheet, getCharacterFrame, getTile
    - TypeScript compilation succeeds (no type errors)
  </verify>
  <done>
    - Engine config created with 32x32 tile size
    - Sprite utilities implemented
    - All exports typed correctly
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Sprite Rendering Test</name>
  <files>
    src/main.ts
  </files>
  <action>
Update src/main.ts to load and render sample sprites as a visual test:

```typescript
import { EngineConfig } from './config/engine';
import { loadSpriteSheet, getCharacterFrame, getTile } from './utils/sprites';

const canvas = document.getElementById('game-canvas') as HTMLCanvasElement;
const ctx = canvas.getContext('2d')!;

// Set canvas size for test display
canvas.width = 400;
canvas.height = 300;

// Disable image smoothing for crisp pixel art
ctx.imageSmoothingEnabled = false;

async function renderTest() {
    try {
        // Load player sprite
        const playerSheet = await loadSpriteSheet('/assets/sprites/characters/player.png');

        // Load a terrain tile (adjust path based on actual downloaded files)
        // Try grass or base terrain
        const terrainSheet = await loadSpriteSheet('/assets/sprites/terrain/grass.png');

        // Clear canvas
        ctx.fillStyle = '#2d2d2d';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Draw terrain tile at position (0,0)
        const tile = getTile(0, 0);
        ctx.drawImage(
            terrainSheet,
            tile.sx, tile.sy, tile.sw, tile.sh,
            10, 10,
            EngineConfig.renderedTileSize,
            EngineConfig.renderedTileSize
        );

        // Draw player sprite (front-facing, first frame)
        const frame = getCharacterFrame('down', 0);
        ctx.drawImage(
            playerSheet,
            frame.col * frame.width,
            frame.row * frame.height,
            frame.width,
            frame.height,
            100, 10,
            frame.width * EngineConfig.scale,
            frame.height * EngineConfig.scale
        );

        // Add labels
        ctx.fillStyle = '#ffffff';
        ctx.font = '14px monospace';
        ctx.fillText(`Tile: ${EngineConfig.tileSize}x${EngineConfig.tileSize} @ ${EngineConfig.scale}x`, 10, 150);
        ctx.fillText('Terrain (left) | Player (right)', 10, 170);
        ctx.fillText('Phase 1: Foundation & Asset Selection - COMPLETE', 10, 200);

        console.log('Sprite rendering test complete');
        console.log(`Tile size: ${EngineConfig.tileSize}px, Scale: ${EngineConfig.scale}x`);
        console.log(`Rendered tile size: ${EngineConfig.renderedTileSize}px`);

    } catch (error) {
        console.error('Sprite loading failed:', error);
        ctx.fillStyle = '#ff0000';
        ctx.fillText('Error loading sprites - check console', 10, 50);
    }
}

renderTest();
```

Adjust sprite paths based on actual downloaded file names/structure from Plan 01.
The key verification is that:
1. Sprites load without error
2. Tiles render at 64px (32 x 2)
3. Player character is visible and correctly sized
  </action>
  <verify>
    - `npm run dev` shows sprites rendering in canvas
    - No console errors about failed sprite loads
    - Terrain tile visible at expected size
    - Player character visible and proportioned correctly
  </verify>
  <done>
    - Sprite loading pipeline works
    - 32x32 tiles render at 2x scale correctly
    - Player sprite displays properly
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Visual Verification of Sprite Rendering</name>
  <what-built>
    Complete Phase 1 foundation:
    - Vite + TypeScript development environment
    - LPC sprite assets downloaded and organized
    - Attribution files for all assets
    - Sprite loading and rendering at 32x32 @ 2x scale
  </what-built>
  <how-to-verify>
    1. Run `npm run dev` in the project directory
    2. Open browser to localhost URL shown in terminal (typically http://localhost:5173)
    3. Verify the following in the canvas:
       - A terrain/grass tile appears (should be 64px square)
       - Player character sprite appears (blonde hair if visible, academic look)
       - Both sprites are crisp (no blurring from scaling)
       - Text labels are readable
    4. Check browser console for any errors
    5. Verify assets/ATTRIBUTION.md exists and lists all asset sources
    6. Verify assets/CREDITS.txt exists in OpenGameArt format
  </how-to-verify>
  <resume-signal>
    Type "approved" if sprites render correctly at proper scale and attribution is complete.
    Describe any issues if sprites appear wrong (wrong size, blurry, missing).
  </resume-signal>
</task>

</tasks>

<verification>
Phase 1 complete when:

**Success Criteria from Roadmap:**
1. All sprite assets have verified CC0 or CC-BY-SA licenses with documentation saved
   - Check: assets/CREDITS.txt and ATTRIBUTION.md exist with all sources

2. Attribution file created listing all asset sources and license requirements
   - Check: Both files reference every downloaded asset pack

3. Development environment (Vite + TypeScript) builds and serves locally
   - Check: `npm run dev` works, `npm run build` succeeds

4. Sample sprite renders correctly at target scale (32x32 tiles at 2x scale)
   - Check: Visual verification shows crisp 64px tiles, no artifacts

**Requirements Coverage:**
- TECH-03: All sprite assets are CC-licensed with proper attribution (ATTRIBUTION.md, CREDITS.txt)
- VIS-01: Consistent LPC pixel art style throughout (all assets from LPC ecosystem)
</verification>

<success_criteria>
- 32x32 LPC tiles render at 2x scale (64px displayed)
- Player sprite loads and displays with blonde hair, academic appearance
- Terrain tiles render crisply without blur
- No JavaScript errors in console
- Attribution files complete for all assets
- Phase 1 requirements TECH-03 and VIS-01 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-asset-selection/01-02-SUMMARY.md`
</output>
